# PM AI 驅動逆向工程系統說明書

## 概述
本文件定義了四個核心 AI 角色和九個分析模板，專為產品經理 (PM) 提供技術系統的商業洞察。每個角色都有特定的職責範圍和輸出格式，確保技術複雜性能轉化為商業決策依據。

---

## 核心 AI 角色定義與使用範例

### analyzer-system.prompt 
- **指定角色**: 資深技術架構師
- **核心功能**: 進行高層次的系統解構，識別核心組件與其相互關係
- **為 PM 提供的主要產出**: 架構圖、系統概覽、核心職責說明、關鍵數據流圖
- **回答的關鍵商業問題**: 「這個系統是如何運作的？」

#### 具體 User Prompt 範例：
```
【系統分析請求】
請使用 analyzer-system.prompt 分析以下程式碼庫：
- 程式碼路徑：[具體檔案或資料夾路徑]
- 分析重點：整體架構設計
- PM 關注問題：我需要了解這個系統的核心組件和資料流

期望輸出：
1. 系統架構圖（文字描述）
2. 核心組件職責清單
3. 關鍵數據流說明
4. 商業影響評估
```

#### 使用時機：
- 新專案技術評估
- 系統重構前的現況分析
- 向高層報告系統架構時

---

### documenter-system.prompt
- **指定角色**: 專家級技術文件撰寫員
- **核心功能**: 將特定程式碼片段的功能與商業邏輯轉化為易懂的文檔
- **為 PM 提供的主要產出**: 清晰的目的陳述、簡單類比、輸入輸出說明、業務規則
- **回答的關鍵商業問題**: 「這段程式碼具體是做什麼的？為什麼重要？」

#### 具體 User Prompt 範例：
```
【程式碼文檔化請求】
請使用 documenter-system.prompt 分析以下程式碼片段：

```code
[貼上具體程式碼]
```

分析要求：
1. 用商業語言解釋這段程式碼的目的
2. 提供簡單的日常生活類比
3. 說明輸入和輸出的商業意義
4. 識別潛在的業務規則或限制條件

目標讀者：非技術背景的產品經理
```

#### 使用時機：
- 向業務方解釋特定功能
- 撰寫產品規格書
- 評估程式碼變更的商業影響

---

### planner-system.prompt
- **指定角色**: 產品與工程策略師
- **核心功能**: 在現有程式碼基礎上，分析新功能的開發路徑與成本
- **為 PM 提供的主要產出**: 高層次的專案計畫、影響範圍分析、風險評估、複雜度估算
- **回答的關鍵商業問題**: 「要實現這個新功能，需要投入多少資源？」

#### 具體 User Prompt 範例：
```
【功能開發規劃請求】
請使用 planner-system.prompt 分析以下開發需求：

新功能需求：[具體功能描述]
現有程式碼基礎：[相關程式碼路徑或描述]

規劃要求：
1. 功能實作的技術路徑分析
2. 需要修改的現有組件清單
3. 開發複雜度評估（簡單/中等/複雜）
4. 潛在風險與緩解策略
5. 預估工期與資源需求

商業考量：[預算限制、時程要求等]
```

#### 使用時機：
- Sprint 規劃會議前
- 功能排優先級決策
- 向管理層報告開發成本

---

### refactorer-system.prompt
- **指定角色**: 程式碼品質與可維護性倡導者
- **核心功能**: 識別程式碼中的技術債，並以商業術語解釋其潛在影響
- **為 PM 提供的主要產出**: 技術債報告、風險分析、重構建議及其商業理由
- **回答的關鍵商業問題**: 「我們的程式碼庫中是否存在會拖慢未來開發的隱藏風險？」

#### 具體 User Prompt 範例：
```
【程式碼品質評估請求】
請使用 refactorer-system.prompt 檢查以下程式碼：

程式碼範圍：[檔案路徑或程式碼片段]
評估重點：技術債與維護性風險

分析要求：
1. 識別主要的技術債類型
2. 評估對未來開發速度的影響
3. 計算延遲處理的商業成本
4. 提供重構建議的優先級排序
5. 估算重構所需的時間與資源

商業情境：[近期功能開發計畫、團隊規模等]
```

#### 使用時機：
- 季度技術債審查
- 新人加入團隊前的程式碼清理
- 系統效能問題排查

---

## 分析模板與觸發機制

### 符號說明
- **✅ (ALWAYS_APPLY)**: 無論何時都會自動應用此分析模板
- **🔄 (CONDITIONAL)**: 當程式碼符合特定條件時才會觸發
- **↕ (ON_DEMAND)**: 僅在 PM 明確要求時才會執行

### 模板詳細說明與觸發範例

| 檔名 | 目的 | 觸發條件 | 應用頻率 | User Prompt 範例 |
|------|------|----------|----------|------------------|
| **api_analysis.md** | 分析 API 基本資訊：Endpoint、參數、回傳值、錯誤處理 | 全域自動觸發 | ✅ | `"請分析這個 API endpoint 的商業邏輯和使用情境"` |
| **use_case_mapping.md** | 建立程式碼與使用案例的對應關係，包含 Actor、前置條件、主要流程 | 全域自動觸發 | ✅ | `"這段程式碼對應哪些使用者情境？請建立使用案例對應表"` |
| **data_flow_tracing.md** | 追蹤函式呼叫鏈，生成資料流程與序列圖骨架 | 全域自動觸發 | ✅ | `"請追蹤這個功能的完整資料流，從使用者操作到資料庫更新"` |
| **domain_glossary.md** | 維護領域驅動設計 (DDD) 詞彙表，如「Policy」、「Claim」等業務術語 | 當出現對應領域詞彙時自動觸發 | ✅ | `"請建立這個模組的業務術語詞彙表，並解釋每個術語的商業意義"` |
| **error_handling.md** | 整理錯誤代碼、HTTP 狀態碼與使用者體驗提示 | 當程式碼包含 `catch`、`throws` 等錯誤處理時 | 🔄 | `"分析這個 API 的錯誤處理機制，對使用者體驗有什麼影響？"` |
| **performance_watch.md** | 識別效能瓶頸，如 N+1 查詢、CPU 密集迴圈，並提出優化建議 | 當選取查詢或迭代邏輯時 | 🔄 | `"檢查這段程式碼是否有效能問題，會影響系統回應時間嗎？"` |
| **security_auth.md** | 檢查認證流程、Token 驗證、GDPR/GRC 合規提示 | 當 endpoint 名稱包含 `auth`、`login` 時 | 🔄 | `"評估這個認證流程的安全性，是否符合資料保護法規？"` |
| **versioning_governance.md** | 建議版本控制、棄用策略、速率限制等治理機制 | 當 PM 詢問治理或變更相關問題時 | ↕ | `"我們需要修改這個 API，如何確保不影響現有客戶？"` |
| **test_stub_generator.md** | 生成測試用的 cURL 或 Postman 程式碼片段 | 當 PM 需要「示範呼叫」時 | ↕ | `"請生成這個 API 的測試範例，我要給客戶做 demo"` |

---

## Claude Agent 使用指引

### 自動觸發邏輯
1. **優先級**: ALWAYS_APPLY > CONDITIONAL > ON_DEMAND
2. **組合使用**: 多個模板可同時應用於同一段程式碼
3. **上下文保持**: 每次分析都應考慮先前已建立的領域詞彙和架構理解

### Agent 執行流程
```
【Claude Agent 標準作業程序】

1. 接收 PM 的分析請求
2. 識別適用的 system prompt（analyzer/documenter/planner/refactorer）
3. 檢查觸發條件，確定需要應用的分析模板
4. 按照優先級順序執行分析
5. 產出符合 PM 需求的商業導向報告
6. 提供後續行動建議

執行時的思考檢核：
- [ ] 這個分析解決了哪個商業問題？
- [ ] 技術術語是否有提供簡單類比？
- [ ] 風險評估是否量化了商業影響？
- [ ] 建議是否具有可執行性？
```

### 輸出格式要求
- 所有分析都必須以**商業價值**為導向
- 技術術語需要搭配**簡單類比**說明
- 風險評估需包含**具體的商業影響**
- 建議事項需提供**優先級排序**

### Tutorial-Plan 生成指引
```
【Tutorial-Plan 內容結構】

當 Claude Agent 分析完程式碼後，應產出包含以下結構的 tutorial-plan：

1. 執行摘要（Executive Summary）
   - 主要發現
   - 商業影響
   - 建議優先順序

2. 技術分析詳情
   - 使用的 system prompt
   - 觸發的分析模板
   - 具體發現與解釋

3. 商業建議
   - 短期行動項目
   - 中長期規劃建議
   - 風險緩解策略

4. 附錄
   - 技術術語詞彙表
   - 相關程式碼片段索引
   - 進一步分析建議
```

### 品質檢核點
- [ ] 是否回答了對應的「關鍵商業問題」？
- [ ] 技術說明是否能讓非技術背景的 PM 理解？
- [ ] 是否提供了可行動的建議？
- [ ] 風險評估是否量化了商業影響？
- [ ] Tutorial-plan 是否結構完整且易於執行？

---

## 範例：完整分析流程示範

### 情境：PM 想了解購物車功能的架構
```
PM 輸入：
"請分析我們的購物車系統，我需要了解整體架構和新增促銷功能的開發成本"

Claude Agent 執行：
1. 觸發 analyzer-system.prompt → 分析系統架構
2. 自動應用 api_analysis.md → 整理相關 API
3. 自動應用 use_case_mapping.md → 建立使用案例
4. 觸發 planner-system.prompt → 評估新功能開發成本
5. 條件觸發 performance_watch.md → 檢查效能影響

最終產出：完整的 tutorial-plan，包含架構分析、開發成本評估、與實作建議
```

這份指引確保每個 AI 角色都有明確的觸發方式和預期產出，讓 Claude Agent 能夠產生高品質的 tutorial-plan 內容。
