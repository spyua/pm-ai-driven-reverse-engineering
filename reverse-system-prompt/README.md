# PM AI 驅動逆向工程系統說明書

## 概述
本文件定義了四個核心 AI 角色和九個分析模板，專為產品經理 (PM) 提供技術系統的商業洞察。每個角色都有特定的職責範圍和輸出格式，確保技術複雜性能轉化為商業決策依據。

---

## 核心 AI 角色定義

### analyzer-system.prompt 
- **指定角色**: 資深技術架構師
- **核心功能**: 進行高層次的系統解構，識別核心組件與其相互關係
- **為 PM 提供的主要產出**: 架構圖、系統概覽、核心職責說明、關鍵數據流圖
- **回答的關鍵商業問題**: 「這個系統是如何運作的？」

### documenter-system.prompt
- **指定角色**: 專家級技術文件撰寫員
- **核心功能**: 將特定程式碼片段的功能與商業邏輯轉化為易懂的文檔
- **為 PM 提供的主要產出**: 清晰的目的陳述、簡單類比、輸入輸出說明、業務規則
- **回答的關鍵商業問題**: 「這段程式碼具體是做什麼的？為什麼重要？」

### planner-system.prompt
- **指定角色**: 產品與工程策略師
- **核心功能**: 在現有程式碼基礎上，分析新功能的開發路徑與成本
- **為 PM 提供的主要產出**: 高層次的專案計畫、影響範圍分析、風險評估、複雜度估算
- **回答的關鍵商業問題**: 「要實現這個新功能，需要投入多少資源？」

### refactorer-system.prompt
- **指定角色**: 程式碼品質與可維護性倡導者
- **核心功能**: 識別程式碼中的技術債，並以商業術語解釋其潛在影響
- **為 PM 提供的主要產出**: 技術債報告、風險分析、重構建議及其商業理由
- **回答的關鍵商業問題**: 「我們的程式碼庫中是否存在會拖慢未來開發的隱藏風險？」

---

## 分析模板與觸發機制

### 符號說明
- **✅ (ALWAYS_APPLY)**: 無論何時都會自動應用此分析模板
- **🔄 (CONDITIONAL)**: 當程式碼符合特定條件時才會觸發
- **↕ (ON_DEMAND)**: 僅在 PM 明確要求時才會執行

### 模板詳細說明

| 檔名 | 目的 | 觸發條件 | 應用頻率 |
|------|------|----------|----------|
| **api_analysis.md** | 分析 API 基本資訊：Endpoint、參數、回傳值、錯誤處理 | 全域自動觸發 | ✅ |
| **use_case_mapping.md** | 建立程式碼與使用案例的對應關係，包含 Actor、前置條件、主要流程 | 全域自動觸發 | ✅ |
| **data_flow_tracing.md** | 追蹤函式呼叫鏈，生成資料流程與序列圖骨架 | 全域自動觸發 | ✅ |
| **domain_glossary.md** | 維護領域驅動設計 (DDD) 詞彙表，如「Policy」、「Claim」等業務術語 | 當出現對應領域詞彙時自動觸發 | ✅ |
| **error_handling.md** | 整理錯誤代碼、HTTP 狀態碼與使用者體驗提示 | 當程式碼包含 `catch`、`throws` 等錯誤處理時 | 🔄 |
| **performance_watch.md** | 識別效能瓶頸，如 N+1 查詢、CPU 密集迴圈，並提出優化建議 | 當選取查詢或迭代邏輯時 | 🔄 |
| **security_auth.md** | 檢查認證流程、Token 驗證、GDPR/GRC 合規提示 | 當 endpoint 名稱包含 `auth`、`login` 時 | 🔄 |
| **versioning_governance.md** | 建議版本控制、棄用策略、速率限制等治理機制 | 當 PM 詢問治理或變更相關問題時 | ↕ |
| **test_stub_generator.md** | 生成測試用的 cURL 或 Postman 程式碼片段 | 當 PM 需要「示範呼叫」時 | ↕ |

---

## AI Agent 使用指引

### 自動觸發邏輯
1. **優先級**: ALWAYS_APPLY > CONDITIONAL > ON_DEMAND
2. **組合使用**: 多個模板可同時應用於同一段程式碼
3. **上下文保持**: 每次分析都應考慮先前已建立的領域詞彙和架構理解

### 輸出格式要求
- 所有分析都必須以**商業價值**為導向
- 技術術語需要搭配**簡單類比**說明
- 風險評估需包含**具體的商業影響**
- 建議事項需提供**優先級排序**

### 品質檢核點
- [ ] 是否回答了對應的「關鍵商業問題」？
- [ ] 技術說明是否能讓非技術背景的 PM 理解？
- [ ] 是否提供了可行動的建議？
- [ ] 風險評估是否量化了商業影響？
